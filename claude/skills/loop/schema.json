{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Work",
  "description": "Work-driven task execution configuration",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string"
    },
    "config": {
      "type": "object",
      "description": "Execution configuration",
      "properties": {
        "stuckThreshold": {
          "type": "integer",
          "default": 3,
          "minimum": 1,
          "description": "Failures before marking stuck"
        },
        "verify": {
          "$ref": "#/$defs/verify",
          "description": "Default verification commands (inherited by all tickets/tasks)"
        }
      },
      "required": ["verify"],
      "additionalProperties": false
    },
    "guidance": {
      "$ref": "#/$defs/guidance",
      "description": "Project-wide guidance (docs, files, notes)"
    },
    "prs": {
      "type": "array",
      "description": "Optional PR groupings - run /pr after last ticket in group completes",
      "items": {
        "$ref": "#/$defs/pr"
      }
    },
    "tickets": {
      "type": "array",
      "description": "List of tickets to complete",
      "items": {
        "$ref": "#/$defs/ticket"
      },
      "minItems": 1
    }
  },
  "required": ["config", "tickets"],
  "additionalProperties": false,
  "$defs": {
    "pr": {
      "type": "object",
      "description": "PR grouping - creates a PR when all tickets in the group are complete",
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "PR title (e.g., 'feat: add validation')"
        },
        "tickets": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1,
          "uniqueItems": true,
          "description": "Ticket names to include in this PR (must match ticket.name values)"
        }
      },
      "required": ["title", "tickets"],
      "additionalProperties": false
    },
    "guidance": {
      "type": "object",
      "description": "Informational context for execution (NOT verification)",
      "properties": {
        "docs": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Files to read for guidelines (CLAUDE.md, CONTRIBUTING.md, etc.)"
        },
        "files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Paths to work in"
        },
        "notes": {
          "type": "string",
          "description": "Free-form guidance"
        },
        "reference": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Files to match patterns from"
        }
      },
      "additionalProperties": false
    },
    "task": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "What to accomplish"
        },
        "done": {
          "type": "boolean",
          "default": false,
          "description": "Completion status"
        },
        "steps": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1,
          "description": "Ordered sub-steps for complex tasks"
        },
        "verify": {
          "$ref": "#/$defs/verify",
          "description": "Task-specific verification (overrides ticket/config)"
        }
      },
      "required": ["description", "done"],
      "additionalProperties": false
    },
    "ticket": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Commit message / ticket name"
        },
        "tasks": {
          "type": "array",
          "items": { "$ref": "#/$defs/task" },
          "minItems": 1
        },
        "type": {
          "type": "string",
          "enum": ["chore", "docs", "feat", "fix", "perf", "refactor", "style", "test"],
          "description": "Commit type"
        },
        "verify": {
          "$ref": "#/$defs/verify",
          "description": "Ticket-specific verification (overrides config, inherited by tasks)"
        }
      },
      "required": ["name", "tasks", "type"],
      "additionalProperties": false
    },
    "verify": {
      "type": "object",
      "description": "Verification commands and manual steps. Merge priority: task > ticket > config (closest non-null wins per property)",
      "properties": {
        "lint": {
          "type": ["string", "null"],
          "description": "Lint command (null to disable)"
        },
        "manual": {
          "type": ["array", "null"],
          "items": { "type": "string", "minLength": 1 },
          "description": "Manual verification steps - user confirms completion after automated checks pass"
        },
        "test": {
          "type": ["string", "null"],
          "description": "Test command (null to disable)"
        },
        "typecheck": {
          "type": ["string", "null"],
          "description": "Type check command (null to disable)"
        }
      },
      "additionalProperties": false
    }
  }
}
